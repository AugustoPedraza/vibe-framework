{
  "$schema": "https://docs.anthropic.com/hooks-schema.json",
  "description": "Vibe framework hooks for automated enforcement. Copy to target project's .claude/hooks.json",
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "description": "Auto-format Elixir files after modification",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.ex ]] || [[ \"$FILE\" == *.exs ]]; then mix format \"$FILE\" 2>/dev/null; fi'",
        "timeout_ms": 10000
      },
      {
        "matcher": "Write|Edit",
        "description": "Auto-format frontend files after modification",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]] || [[ \"$FILE\" == *.ts ]] || [[ \"$FILE\" == *.js ]] || [[ \"$FILE\" == *.css ]]; then npx prettier --write \"$FILE\" 2>/dev/null; fi'",
        "timeout_ms": 10000
      },
      {
        "matcher": "Write|Edit",
        "description": "Check for raw color values in Svelte/CSS files (design system enforcement)",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]] || [[ \"$FILE\" == *.css ]]; then if grep -qE \"(bg|text|border)-(red|yellow|purple|pink|orange|teal|indigo|violet|fuchsia|rose|slate|zinc|stone|amber|lime|emerald|cyan|sky)-[0-9]+\" \"$FILE\" 2>/dev/null; then echo \"WARNING: Raw Tailwind color found. Use design tokens (bg-primary, text-foreground, etc.). Gray/blue/green scales are allowed but prefer semantic tokens.\"; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "Check for hardcoded z-index in Svelte files",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then if grep -qE \"\\bz-(\\[|[0-9]+)\" \"$FILE\" 2>/dev/null && ! grep -qE \"z-(base|raised|dropdown|sticky|overlay|modal|popover|toast|tooltip)\" \"$FILE\" 2>/dev/null; then echo \"WARNING: Hardcoded z-index found. Use named tokens: z-base, z-raised, z-dropdown, z-sticky, z-overlay, z-modal, z-popover, z-toast, z-tooltip.\"; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "Check for arbitrary Tailwind values in Svelte files",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then if grep -qE \"[whmpt]-\\[\" \"$FILE\" 2>/dev/null; then echo \"WARNING: Arbitrary Tailwind value found (e.g. w-[300px]). Use design token scale instead.\"; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "Check for non-standard border radius in Svelte files",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then if grep -qE \"rounded-(2xl|3xl)\" \"$FILE\" 2>/dev/null; then echo \"WARNING: Non-standard border radius. Use rounded-sm, rounded-md, rounded-lg, rounded-xl, or rounded-full.\"; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "BLOCKER: Svelte component size (300 line limit)",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then LINES=$(wc -l < \"$FILE\" 2>/dev/null); if [ \"$LINES\" -gt 300 ] 2>/dev/null; then echo \"BLOCKER: Component is $LINES lines (limit: 300). Decompose using component folder structure pattern (index.svelte + sibling sub-components).\"; exit 1; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "Check for hardcoded values in style attributes/directives (allows dynamic bindings and CSS custom properties)",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then ISSUES=\"\"; while IFS= read -r line; do linenum=$(echo \"$line\" | cut -d: -f1); content=$(echo \"$line\" | cut -d: -f2-); if echo \"$content\" | grep -qE \"style:[a-z].*=\\\"[^{]\"; then if ! echo \"$content\" | grep -qE \"style:--\"; then ISSUES=\"$ISSUES  Line $linenum: Hardcoded style: directive — use Tailwind class or dynamic binding\\n\"; fi; fi; done < <(grep -nE \"style[:=]\" \"$FILE\" 2>/dev/null); while IFS= read -r line; do linenum=$(echo \"$line\" | cut -d: -f1); content=$(echo \"$line\" | cut -d: -f2-); ISSUES=\"$ISSUES  Line $linenum: Raw style=\\\"\\\" attribute — use style: directives or Tailwind classes\\n\"; done < <(grep -nE \"\\bstyle=\\\"[^{]\" \"$FILE\" 2>/dev/null); if [ -n \"$ISSUES\" ]; then echo \"WARNING: Inline style issues found:\"; echo -e \"$ISSUES\"; echo \"Allowed: style:prop=\\\"{dynamic}\\\", style:--custom-prop={value}\"; echo \"Use Tailwind classes for static values. See rules/svelte-patterns.md #Dynamic Styles.\"; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "BLOCKER: Missing async states in Svelte components (loading/error/empty)",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then HAS_ASYNC=false; if grep -qE \"(\\{#await|fetch\\(|onMount.*async|\\$effect.*fetch|loading)\" \"$FILE\" 2>/dev/null; then HAS_ASYNC=true; fi; if [ \"$HAS_ASYNC\" = true ]; then MISSING=\"\"; if ! grep -qE \"(skeleton|Skeleton|spinner|loading|shimmer)\" \"$FILE\" 2>/dev/null; then MISSING=\"$MISSING loading-pattern\"; fi; if ! grep -qE \"(role=.alert.|error|catch)\" \"$FILE\" 2>/dev/null; then MISSING=\"$MISSING error-state\"; fi; if ! grep -qE \"(EmptyState|empty|No .* found|No .* yet|length === 0|\\.length === 0)\" \"$FILE\" 2>/dev/null; then MISSING=\"$MISSING empty-state\"; fi; if [ -n \"$MISSING\" ]; then echo \"BLOCKER: Async component missing states:$MISSING. All 4 states required (loading/error/empty/success). See rules/ux-validation.md.\"; exit 1; fi; fi; fi'",
        "timeout_ms": 5000
      },
      {
        "matcher": "Write|Edit",
        "description": "Run related Elixir test after modifying implementation files",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == lib/syna/*.ex ]] && [[ \"$FILE\" != *_test.exs ]]; then TEST=$(echo \"$FILE\" | sed \"s|lib/|test/|;s|\\.ex$|_test.exs|\"); if [ -f \"$TEST\" ]; then mix test \"$TEST\" --no-color 2>&1 | tail -3; fi; fi'",
        "timeout_ms": 30000
      },
      {
        "matcher": "Write|Edit",
        "description": "Run related vitest after modifying Svelte components",
        "command": "bash -c 'FILE=\"$CLAUDE_FILE_PATH\"; if [[ \"$FILE\" == *.svelte ]]; then TESTDIR=$(dirname \"$FILE\" | sed \"s|svelte/components|tests/components|\"); TESTFILE=\"$TESTDIR/$(basename \"$FILE\" .svelte).test.ts\"; if [ -f \"$TESTFILE\" ]; then cd assets && npx vitest run \"$TESTFILE\" --reporter=dot 2>&1 | tail -3; fi; fi'",
        "timeout_ms": 30000
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "description": "Quality check before git commits",
        "command": "bash -c 'CMD=\"$CLAUDE_BASH_COMMAND\"; if echo \"$CMD\" | grep -q \"git commit\"; then echo \"Pre-commit: Ensure tests pass and code is formatted before committing.\"; fi'",
        "timeout_ms": 5000
      }
    ],
    "Stop": [
      {
        "type": "agent",
        "description": "UI quality gate — validate all modified Svelte files before task completion",
        "command": "bash -c 'ISSUES=\"\"; for FILE in $(git diff --name-only HEAD 2>/dev/null | grep \"\\.svelte$\"); do if [ -f \"$FILE\" ]; then NAME=$(basename \"$FILE\"); HAS_ASYNC=false; if grep -qE \"(\\{#await|fetch\\(|onMount.*async|\\$effect.*fetch|loading)\" \"$FILE\" 2>/dev/null; then HAS_ASYNC=true; fi; if [ \"$HAS_ASYNC\" = true ]; then if ! grep -qE \"(skeleton|Skeleton|shimmer)\" \"$FILE\" 2>/dev/null; then ISSUES=\"$ISSUES\\n$NAME: Missing loading/skeleton state\"; fi; if ! grep -qE \"(role=.alert.|catch)\" \"$FILE\" 2>/dev/null; then ISSUES=\"$ISSUES\\n$NAME: Missing error state (role=alert)\"; fi; if ! grep -qE \"(EmptyState|empty|No .* found|length === 0)\" \"$FILE\" 2>/dev/null; then ISSUES=\"$ISSUES\\n$NAME: Missing empty state\"; fi; fi; if grep -qE \"(button|btn|Button)\" \"$FILE\" 2>/dev/null; then if ! grep -qE \"(hover:|:hover|active:|:active)\" \"$FILE\" 2>/dev/null; then ISSUES=\"$ISSUES\\n$NAME: Buttons missing hover/active states\"; fi; fi; if grep -qE \"outline:\\s*none\" \"$FILE\" 2>/dev/null; then if ! grep -qE \"focus-visible\" \"$FILE\" 2>/dev/null; then ISSUES=\"$ISSUES\\n$NAME: outline:none without focus-visible replacement\"; fi; fi; fi; done; if [ -n \"$ISSUES\" ]; then echo \"UI QUALITY GATE — issues found:\"; echo -e \"$ISSUES\"; echo \"\"; echo \"Fix these before completing. See rules/ui-polish.md and rules/ux-validation.md.\"; fi'",
        "timeout_ms": 15000
      }
    ],
    "TaskCompleted": [
      {
        "description": "Verify tests pass before marking task complete",
        "command": "bash -c 'if [ -f \"assets/package.json\" ] && grep -q \"vitest\" \"assets/package.json\" 2>/dev/null; then cd assets && npx vitest run --reporter=json 2>/dev/null | tail -1 | python3 -c \"import sys,json; d=json.load(sys.stdin); sys.exit(0 if d.get(\\\"success\\\") else 1)\" 2>/dev/null; if [ $? -ne 0 ]; then echo \"WARNING: Tests are not passing. Fix before marking task complete.\"; fi; fi'",
        "timeout_ms": 60000
      }
    ]
  }
}
