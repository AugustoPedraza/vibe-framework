{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Vibe Config",
  "description": "Configuration for vibe framework in a project",
  "type": "object",
  "required": ["project", "paths"],
  "properties": {
    "project": {
      "type": "object",
      "description": "Project identification",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name (used in phase headers)"
        },
        "core_kpi": {
          "type": "string",
          "description": "Primary success metric for the project"
        },
        "type": {
          "type": "string",
          "enum": ["web", "pwa", "mobile", "api"],
          "description": "Project type (affects checklists)"
        }
      }
    },
    "stack": {
      "type": "object",
      "description": "Technology stack (for pattern filtering)",
      "properties": {
        "backend": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Backend technologies (e.g., elixir, ash, phoenix)"
        },
        "frontend": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Frontend technologies (e.g., svelte, react, tailwind)"
        },
        "database": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Database technologies (e.g., postgres, sqlite)"
        }
      }
    },
    "paths": {
      "type": "object",
      "description": "Project paths (relative to project root)",
      "required": ["architecture", "domain", "features"],
      "properties": {
        "architecture": {
          "type": "string",
          "description": "Path to architecture docs",
          "default": "architecture/"
        },
        "domain": {
          "type": "string",
          "description": "Path to domain docs",
          "default": "docs/domain/"
        },
        "features": {
          "type": "string",
          "description": "Path to feature specs",
          "default": "docs/domain/features/"
        }
      }
    },
    "modules": {
      "type": "object",
      "description": "Code module naming (for code generation)",
      "properties": {
        "domain_prefix": {
          "type": "string",
          "description": "Domain module prefix (e.g., MyApp)"
        },
        "web_prefix": {
          "type": "string",
          "description": "Web module prefix (e.g., MyAppWeb)"
        }
      }
    },
    "ux": {
      "type": "object",
      "description": "UX requirements (affects checklists)",
      "properties": {
        "pwa": {
          "type": "boolean",
          "description": "Is this a PWA?",
          "default": false
        },
        "mobile_first": {
          "type": "boolean",
          "description": "Mobile-first design?",
          "default": false
        },
        "offline_required": {
          "type": "boolean",
          "description": "Must work offline?",
          "default": false
        }
      }
    },
    "commands": {
      "type": "object",
      "description": "Project-specific commands",
      "properties": {
        "check": {
          "type": "string",
          "description": "Quality check command",
          "default": "just check"
        },
        "test": {
          "type": "string",
          "description": "Test command",
          "default": "just test"
        },
        "dev": {
          "type": "string",
          "description": "Dev server command",
          "default": "just dev"
        }
      }
    },
    "sync": {
      "type": "object",
      "description": "Template sync configuration",
      "properties": {
        "template_path": {
          "type": "string",
          "description": "Path to local template repo",
          "default": "~/projects/vibe-ash-svelte-template"
        },
        "ignored_files": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Files to ignore during sync",
          "default": []
        },
        "last_sync": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Last sync timestamp"
        }
      }
    },
    "migration": {
      "type": "object",
      "description": "Migration configuration (strangler fig pattern)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable migration mode",
          "default": false
        },
        "template_repo": {
          "type": "string",
          "description": "Target architecture template repository URL",
          "default": "https://github.com/AugustoPedraza/vibe-ash-svelte-template"
        },
        "current_stack": {
          "type": "object",
          "description": "Current technology stack being migrated FROM",
          "properties": {
            "backend": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Current backend (e.g., [\"phoenix\", \"liveview\"] or [\"rails\", \"graphql\"])"
            },
            "frontend": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Current frontend (e.g., [\"liveview\"] or [\"vue\", \"capacitor\"])"
            }
          }
        },
        "test_requirements": {
          "type": "object",
          "description": "Test requirements for migration safety",
          "properties": {
            "require_regression_tests": {
              "type": "boolean",
              "description": "Require regression tests before migration",
              "default": true
            },
            "tests_must_pass_legacy": {
              "type": "boolean",
              "description": "Tests must pass against legacy code first",
              "default": true
            }
          }
        }
      }
    },
    "parallel_agents": {
      "type": "object",
      "description": "Configuration for parallel implementation workflow",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable parallel implementation mode (/vibe parallel)",
          "default": true
        },
        "mode": {
          "type": "string",
          "enum": ["quality", "balanced", "speed"],
          "description": "Parallel mode: quality (strict verification), balanced (standard), speed (minimal)",
          "default": "quality"
        },
        "auto_approve_minor_changes": {
          "type": "boolean",
          "description": "Auto-approve non-breaking contract changes (additive fields, new error codes)",
          "default": true
        },
        "require_human_for_breaking": {
          "type": "boolean",
          "description": "Require human approval for breaking contract changes",
          "default": true
        },
        "max_parallel_agents": {
          "type": "integer",
          "description": "Maximum number of parallel agents",
          "default": 4,
          "minimum": 2,
          "maximum": 8
        },
        "lock_timeout_minutes": {
          "type": "integer",
          "description": "File lock timeout in minutes (prevents stale locks)",
          "default": 120,
          "minimum": 30,
          "maximum": 480
        },
        "sync_point_timeout_minutes": {
          "type": "integer",
          "description": "Timeout for waiting at sync point",
          "default": 60,
          "minimum": 15,
          "maximum": 180
        },
        "contract_paths": {
          "type": "object",
          "description": "Paths for contract-related files",
          "properties": {
            "contracts": {
              "type": "string",
              "description": "Path to store interface contracts",
              "default": ".claude/contracts/"
            },
            "locks": {
              "type": "string",
              "description": "Path to store file locks",
              "default": ".claude/locks/"
            },
            "sync_points": {
              "type": "string",
              "description": "Path to store sync point records",
              "default": ".claude/sync-points/"
            },
            "change_requests": {
              "type": "string",
              "description": "Path to store change requests",
              "default": ".claude/change-requests/"
            }
          }
        },
        "file_ownership": {
          "type": "object",
          "description": "Default file ownership patterns for streams",
          "properties": {
            "backend_patterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Glob patterns for backend-owned files",
              "default": ["lib/*/", "test/*/"]
            },
            "frontend_patterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Glob patterns for frontend-owned files",
              "default": ["assets/svelte/", "assets/js/"]
            },
            "integration_patterns": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Glob patterns for integration-owned files",
              "default": ["lib/*_web/live/", "assets/tests/e2e/"]
            }
          }
        }
      }
    },
    "agent_architecture": {
      "type": "object",
      "description": "Configuration for agent-first parallel implementation architecture",
      "properties": {
        "default_mode": {
          "type": "string",
          "enum": ["parallel", "quick", "solo"],
          "description": "Default execution mode for /vibe [ID]",
          "default": "parallel"
        },
        "auto_detect_complexity": {
          "type": "boolean",
          "description": "Automatically suggest mode based on feature complexity",
          "default": true
        },
        "watchers": {
          "type": "object",
          "description": "Enable/disable QA watchers",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Master switch for all watchers",
              "default": true
            },
            "format": {
              "type": "boolean",
              "description": "Enable format-watcher",
              "default": true
            },
            "lint": {
              "type": "boolean",
              "description": "Enable lint-watcher",
              "default": true
            },
            "test": {
              "type": "boolean",
              "description": "Enable test-watcher",
              "default": true
            },
            "security": {
              "type": "boolean",
              "description": "Enable security-watcher",
              "default": false
            }
          }
        },
        "models": {
          "type": "object",
          "description": "Model assignments for each agent type",
          "properties": {
            "orchestrator": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Model for orchestrator",
              "default": "opus"
            },
            "domain-agent": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Model for domain agent",
              "default": "opus"
            },
            "api-agent": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Model for API agent",
              "default": "opus"
            },
            "ui-agent": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Model for UI agent",
              "default": "sonnet"
            },
            "data-agent": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Model for data agent",
              "default": "sonnet"
            },
            "watchers": {
              "type": "string",
              "enum": ["opus", "sonnet", "haiku"],
              "description": "Default model for watcher agents",
              "default": "haiku"
            }
          }
        },
        "context_budgets": {
          "type": "object",
          "description": "Token budgets for each agent type",
          "properties": {
            "orchestrator": { "type": "integer", "default": 50000 },
            "domain-agent": { "type": "integer", "default": 40000 },
            "api-agent": { "type": "integer", "default": 35000 },
            "ui-agent": { "type": "integer", "default": 30000 },
            "data-agent": { "type": "integer", "default": 25000 },
            "watchers": { "type": "integer", "default": 15000 }
          }
        },
        "progress_polling_interval_ms": {
          "type": "integer",
          "description": "How often orchestrator checks agent progress files",
          "default": 30000,
          "minimum": 10000,
          "maximum": 120000
        },
        "stale_agent_timeout_ms": {
          "type": "integer",
          "description": "Time without progress update before agent considered stale",
          "default": 180000,
          "minimum": 60000,
          "maximum": 600000
        }
      }
    },
    "ui_validation": {
      "type": "object",
      "description": "UI validation configuration for visual correctness during /vibe workflow. Enables AI to validate components render correctly before committing.",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable UI validation in Developer/QA phases",
          "default": true
        },
        "blocking": {
          "type": "boolean",
          "description": "HARD BLOCK on validation failures (vs advisory warnings)",
          "default": true
        },
        "mcp_server": {
          "type": "string",
          "description": "MCP browser server to use for DOM inspection",
          "default": "@anthropic-ai/mcp-server-playwright"
        },
        "dev_server": {
          "type": "object",
          "description": "Dev server configuration",
          "properties": {
            "url": {
              "type": "string",
              "description": "Dev server base URL",
              "default": "http://localhost:4000"
            },
            "startup_command": {
              "type": "string",
              "description": "Command to start dev server if not running",
              "default": "mix phx.server"
            },
            "ready_timeout": {
              "type": "number",
              "description": "Seconds to wait for dev server to be ready",
              "default": 30
            }
          }
        },
        "temp_file": {
          "type": "object",
          "description": "Temporary validation file settings (AI creates, validates, deletes)",
          "properties": {
            "path": {
              "type": "string",
              "description": "Where to write temp validation HTML",
              "default": "assets/__validate__.html"
            },
            "base_css": {
              "type": "string",
              "description": "Path to base CSS to include",
              "default": "/assets/app.css"
            },
            "cleanup": {
              "type": "boolean",
              "description": "Delete temp file after validation",
              "default": true
            }
          }
        },
        "viewports": {
          "type": "array",
          "description": "Screen sizes to validate",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Viewport name for reporting"
              },
              "width": {
                "type": "number",
                "description": "Viewport width in pixels"
              },
              "height": {
                "type": "number",
                "description": "Viewport height in pixels"
              }
            },
            "required": ["name", "width", "height"]
          },
          "default": [
            { "name": "mobile", "width": 375, "height": 812 },
            { "name": "desktop", "width": 1280, "height": 800 }
          ]
        },
        "rules": {
          "type": "object",
          "description": "Design system rules to validate via DOM inspection",
          "properties": {
            "touch_target_min": {
              "type": "number",
              "description": "Minimum touch target size in px",
              "default": 44
            },
            "button_heights": {
              "type": "array",
              "items": { "type": "number" },
              "description": "Valid button heights in px",
              "default": [32, 40, 48]
            },
            "spacing_grid": {
              "type": "number",
              "description": "Spacing must be multiple of this value",
              "default": 4
            },
            "primary_action_zone": {
              "type": "string",
              "enum": ["bottom_half", "any"],
              "description": "Where primary actions must be positioned (mobile)",
              "default": "bottom_half"
            },
            "input_height": {
              "type": "number",
              "description": "Standard input height in px",
              "default": 40
            },
            "focus_visible_required": {
              "type": "boolean",
              "description": "All interactive elements must have visible focus",
              "default": true
            },
            "skeleton_for_loading": {
              "type": "boolean",
              "description": "Loading states must use skeleton, not spinner",
              "default": true
            }
          }
        },
        "design_tokens": {
          "type": "object",
          "description": "Design tokens that must be used (no raw values allowed)",
          "properties": {
            "colors": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Allowed color tokens",
              "default": [
                "primary", "primary-foreground",
                "secondary", "secondary-foreground",
                "success", "success-foreground", "success-soft",
                "warning", "warning-foreground", "warning-soft",
                "error", "error-foreground", "error-soft",
                "info", "info-foreground", "info-soft",
                "background", "foreground", "card", "muted", "muted-foreground",
                "accent", "accent-foreground", "popover", "popover-foreground",
                "border", "input", "ring", "disabled", "disabled-foreground"
              ]
            },
            "spacing": {
              "type": "array",
              "items": { "type": "number" },
              "description": "Allowed spacing values (Tailwind units)",
              "default": [0, 0.5, 1, 2, 3, 4, 6, 8, 12, 16, 20, 24]
            },
            "radius": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Allowed border radius tokens",
              "default": ["none", "sm", "md", "lg", "full"]
            },
            "shadows": {
              "type": "array",
              "items": { "type": "string" },
              "description": "Allowed shadow tokens",
              "default": ["xs", "sm", "md", "lg", "xl"]
            }
          }
        },
        "parallel": {
          "type": "object",
          "description": "Parallel validation settings for faster feedback",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Run validations in parallel (viewports + states)",
              "default": true
            },
            "max_agents": {
              "type": "number",
              "description": "Maximum parallel validation agents",
              "default": 4
            }
          }
        },
        "auto_fix": {
          "type": "object",
          "description": "Which issues AI can auto-fix without asking human",
          "properties": {
            "spacing": {
              "type": "boolean",
              "description": "Auto-fix spacing to nearest grid value",
              "default": true
            },
            "design_tokens": {
              "type": "boolean",
              "description": "Auto-replace raw colors with tokens",
              "default": true
            },
            "aria_labels": {
              "type": "boolean",
              "description": "Auto-generate aria-labels for icon buttons",
              "default": true
            },
            "layout": {
              "type": "boolean",
              "description": "Auto-fix layout issues (risky, requires human judgment)",
              "default": false
            }
          }
        },
        "default_states": {
          "type": "object",
          "description": "Default states to validate for all components (loading/empty/error/success)",
          "additionalProperties": {
            "type": "object",
            "description": "Props to pass for this state"
          },
          "default": {
            "loading": { "loading": true, "error": null, "data": null },
            "empty": { "loading": false, "error": null, "data": [] },
            "error": { "loading": false, "error": "Something went wrong", "data": null },
            "success": { "loading": false, "error": null, "data": "{{mock}}" }
          }
        },
        "components": {
          "type": "object",
          "description": "Component-specific validation configuration",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string",
                "description": "Import path relative to components directory"
              },
              "states": {
                "type": "object",
                "description": "State name -> props mapping for this component",
                "additionalProperties": {
                  "type": "object",
                  "description": "Props to hydrate component with for this state"
                }
              },
              "viewports": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Which viewports to test (defaults to all)"
              },
              "skip_rules": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Rules to skip for this component (e.g., primary_action_zone for modals)"
              }
            },
            "required": ["path", "states"]
          }
        }
      }
    }
  }
}
