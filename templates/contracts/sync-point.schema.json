{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Sync Point",
  "description": "Verification checkpoint between parallel streams. Both backend and frontend must pass before integration can begin.",
  "type": "object",
  "required": ["feature_id", "contract_version", "streams", "created_at"],
  "properties": {
    "feature_id": {
      "type": "string",
      "description": "Feature identifier (e.g., AUTH-001)",
      "pattern": "^[A-Z]+-[0-9]+$"
    },
    "contract_version": {
      "type": "integer",
      "description": "Version of the interface contract"
    },
    "sync_status": {
      "type": "string",
      "enum": ["waiting", "verifying", "passed", "failed"],
      "description": "Overall sync point status"
    },
    "streams": {
      "type": "object",
      "description": "Status of each stream",
      "properties": {
        "backend": {
          "$ref": "#/$defs/stream_status"
        },
        "frontend": {
          "$ref": "#/$defs/stream_status"
        }
      },
      "required": ["backend", "frontend"]
    },
    "contract_compliance": {
      "type": "object",
      "description": "Verification that implementations match contract",
      "properties": {
        "backend": {
          "$ref": "#/$defs/compliance_check"
        },
        "frontend": {
          "$ref": "#/$defs/compliance_check"
        }
      }
    },
    "blockers": {
      "type": "array",
      "description": "Issues preventing sync point passage",
      "items": {
        "type": "object",
        "properties": {
          "stream": {
            "type": "string",
            "enum": ["backend", "frontend", "both"]
          },
          "type": {
            "type": "string",
            "enum": ["test_failure", "contract_violation", "timeout", "blocked_on_change_request"]
          },
          "description": { "type": "string" },
          "resolution": { "type": "string" }
        }
      }
    },
    "verification_started_at": {
      "type": "string",
      "format": "date-time"
    },
    "verification_completed_at": {
      "type": "string",
      "format": "date-time"
    },
    "created_at": {
      "type": "string",
      "format": "date-time"
    }
  },
  "$defs": {
    "stream_status": {
      "type": "object",
      "description": "Status for a single stream at sync point",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["in_progress", "waiting", "complete", "failed"],
          "description": "Stream completion status"
        },
        "criteria_status": {
          "type": "object",
          "description": "Status of acceptance criteria",
          "properties": {
            "total": { "type": "integer" },
            "completed": { "type": "integer" },
            "failed": { "type": "integer" },
            "details": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": { "type": "string" },
                  "status": {
                    "type": "string",
                    "enum": ["passed", "failed", "skipped"]
                  },
                  "failure_reason": { "type": "string" }
                }
              }
            }
          }
        },
        "test_results": {
          "type": "object",
          "description": "Test execution summary",
          "properties": {
            "total": { "type": "integer" },
            "passing": { "type": "integer" },
            "failing": { "type": "integer" },
            "skipped": { "type": "integer" },
            "coverage_percent": { "type": "number" }
          }
        },
        "completed_at": {
          "type": "string",
          "format": "date-time"
        },
        "agent_id": {
          "type": "string",
          "description": "ID of agent that completed this stream"
        }
      }
    },
    "compliance_check": {
      "type": "object",
      "description": "Contract compliance verification",
      "properties": {
        "passed": { "type": "boolean" },
        "checks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "check": { "type": "string" },
              "status": {
                "type": "string",
                "enum": ["passed", "failed", "warning"]
              },
              "details": { "type": "string" }
            }
          }
        }
      }
    }
  },
  "example": {
    "feature_id": "AUTH-001",
    "contract_version": 1,
    "sync_status": "passed",
    "streams": {
      "backend": {
        "status": "complete",
        "criteria_status": {
          "total": 2,
          "completed": 2,
          "failed": 0,
          "details": [
            { "id": "AC-1", "status": "passed" },
            { "id": "AC-2", "status": "passed" }
          ]
        },
        "test_results": {
          "total": 5,
          "passing": 5,
          "failing": 0,
          "skipped": 0,
          "coverage_percent": 92.5
        },
        "completed_at": "2026-01-23T10:45:00Z",
        "agent_id": "backend-agent-abc123"
      },
      "frontend": {
        "status": "complete",
        "criteria_status": {
          "total": 2,
          "completed": 2,
          "failed": 0,
          "details": [
            { "id": "AC-3", "status": "passed" },
            { "id": "AC-4", "status": "passed" }
          ]
        },
        "test_results": {
          "total": 8,
          "passing": 8,
          "failing": 0,
          "skipped": 0,
          "coverage_percent": 88.0
        },
        "completed_at": "2026-01-23T10:50:00Z",
        "agent_id": "frontend-agent-def456"
      }
    },
    "contract_compliance": {
      "backend": {
        "passed": true,
        "checks": [
          { "check": "Action 'authenticate' signature matches contract", "status": "passed" },
          { "check": "Return type matches 'User' shape", "status": "passed" },
          { "check": "Error 'invalid_credentials' implemented", "status": "passed" },
          { "check": "Error 'account_locked' implemented", "status": "passed" }
        ]
      },
      "frontend": {
        "passed": true,
        "checks": [
          { "check": "Component 'LoginForm' props match contract", "status": "passed" },
          { "check": "All states handled: default, loading, error", "status": "passed" },
          { "check": "Event 'submit' dispatches LoginCredentials shape", "status": "passed" },
          { "check": "Accessibility requirements met", "status": "passed" }
        ]
      }
    },
    "blockers": [],
    "verification_started_at": "2026-01-23T10:50:00Z",
    "verification_completed_at": "2026-01-23T10:51:00Z",
    "created_at": "2026-01-23T10:00:00Z"
  }
}
